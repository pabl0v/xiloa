<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:sec="http://www.springframework.org/security/tags">
    <h:head>
	<link type="text/css" rel="stylesheet" href="../../resources/css/solicitudes.css"></link>
    </h:head>
    <h:body>
 
    <div id="contenedor">
    	<div id="header">
            <ui:insert name="header" >
                <ui:include src="../../modulos/compartido/paginamaestra.xhtml" />
	    	</ui:insert>
	    	 <script type="text/javascript" src="../../resources/scripts/solicitudes.js"></script>
		</div>	
		<h:form id="formSolicitudes">	            
        <div id="cabezera">
            <h2>Solicitudes Activas</h2>
            <sec:authorize ifAnyGranted="ROLE_RIGHT_EDITAR_PORTAFOLIO">                  
            <div id="botones_filtro_contenedor">                 
                <div class="botones_filtro" onclick="window.location='/Xiloa/modulos/solicitudes/registro_solicitud.xhtml'" >
                	<p class="icono_nuevo">Nueva solicitud</p>
                </div>                           
                <div class="botones_filtro">
                	<p class="icono_exportar"></p>
                	<h:commandLink style="margin-bottom: 5px" >  
            			<h:outputText value="Descargar" />   
            			<p:dataExporter type="xls" target="dtSolicitud" fileName="ReporteSolicitudes" />           		
        			</h:commandLink>
        		</div>                
            </div>
            </sec:authorize>
       </div>
            
		<div id="contenedor_filtro">             	
			<p:splitButton value="Solicitud Candidato" icon="ui-icon-print" title="Generar Solicitud Candidato" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.runSolicitudCandidato}"  update=":formSolicitudes:msgSolicitudes" >   
				<p:separator />         		   
				<p:menuitem value="Pre-Matricula" icon="ui-icon-print" title="Generar Formato Pre-Matricula" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.runPreMatricula}" update=":formSolicitudes:msgSolicitudes"  />	       		             
				<p:menuitem value="Emisi贸n Juicio" icon="ui-icon-print" title="Imprimir Emisi贸n de Juicio y Reporte de Orientaci贸n" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.runEmisionJuicio}" update=":formSolicitudes:msgSolicitudes"  />	       		             
				<p:menuitem value="Informe Asesor" icon="ui-icon-print" title="Generar Informe del Asesor" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.runInformeAsesor}" update=":formSolicitudes:msgSolicitudes"  />	       		 					       		   
				<p:menuitem value="Plan Capacitacion" icon="ui-icon-print" title="Generar Plan de Capacitacion" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.runPlanCapacitacion}" update=":formSolicitudes:msgSolicitudes"  />	       		 
				<p:menuitem value="Certificado" icon="ui-icon-print" title="Imprimir Certificado" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.runCertificado}" update=":formSolicitudes:msgSolicitudes"  />				       		         	   	       			     			       			  
			</p:splitButton>           		    			    			    		   
		</div>
        <div id="contenedor_tabla_solicitudes">     
        	<p:messages id="msgSolicitudes" showDetail="true" autoUpdate="true" closable="true" />        	      
        	<p:dataTable id="dtSolicitud" widgetVar="dtSolicitudes" emptyMessage="No existen solicitudes activas" 
        	             var="varSolicitudI" value="#{dashBoardSolicitudesManagedBean.listaSolicitudes}" 
        	             selectionMode="single" rowKey="#{varSolicitudI.id}"
        	             selection="#{dashBoardSolicitudesManagedBean.selectedSolicitud}"         	              
        	             paginator="true" rows="12"  >
        	    <sec:authorize ifAnyGranted="ROLE_RIGHT_MENU_PARTICIPANTE">     	      
	        		<p:ajax event="rowSelect" listener="#{dashBoardSolicitudesManagedBean.onRowSelectDtSolicitudes}" update=":formSolicitudes:btnEnviarSolicitud" />  
					<p:ajax event="rowUnselect" listener="#{dashBoardSolicitudesManagedBean.onRowUnSelectDtSolicitudes}" update=":formSolicitudes:btnEnviarSolicitud" />       		                               
				</sec:authorize>
				<!--Las columnas de la tabla-->
                <p:column id="expedienteColumn" exportable="true" filterBy="#{varSolicitudI.id}" filterMatchMode="contains">
                	<f:facet name="header">  
            			<h:outputText value="Exp." />  
        			</f:facet> 
                	<h:outputText value="#{varSolicitudI.id}" />
                </p:column>
                <p:column id="centroColumn" exportable="true" filterBy="#{varSolicitudI.certificacion.ifpNombre}" filterOptions="#{dashBoardSolicitudesManagedBean.listaCentros}" filterMatchMode="exact">
                	<f:facet name="header">  
            			<h:outputText value="Centro evaluador" />  
        			</f:facet> 
                	<h:outputText value="#{varSolicitudI.certificacion.ifpNombre}" />
                </p:column>                      
                <p:column id="candidatoColumn" exportable="true" filterBy="#{varSolicitudI.contacto.nombreCompleto}"  filterMatchMode="contains">
                	<f:facet name="header">  
            			<h:outputText value="Candidato" />  
        			</f:facet> 
                	<h:outputText value="#{varSolicitudI.contacto.nombreCompleto}" />
                 </p:column>  
                <p:column id="certificacionColumn" exportable="true" filterBy="#{varSolicitudI.certificacion.nombre}" filterMatchMode="contains">
                	<f:facet name="header">  
            			<h:outputText value="Certificacion" />  
        			</f:facet> 
                	<h:outputText value="#{varSolicitudI.certificacion.nombre}"/>
                </p:column>  
                <p:column id="fechaColumn" exportable="true">
                	<f:facet name="header">  
            			<h:outputText value="Fecha solicitud" />  
        			</f:facet> 
                	<h:outputText value="#{varSolicitudI.fechaRegistro}" >
                		<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
                	</h:outputText>
                </p:column>               
                <p:column id="estadoColumn" exportable="true" filterBy="#{varSolicitudI.estatus.valor}" filterOptions="#{dashBoardSolicitudesManagedBean.listaEstatus}" filterMatchMode="exact">
                	<f:facet name="header">
            			<h:outputText value="Estado" />  
        			</f:facet>
                	<h:outputText value="#{varSolicitudI.estatus.valor}" />
                </p:column>
				<p:column>
					<p:splitButton value="Gesti贸n de Solicitud" icon="ui-icon-pencil" title="Gestion del Candidato" style="display:inline-block;"  update=":formSolicitudes:dtSolicitud" >   
	        	 		<p:separator />
						<sec:authorize ifAnyGranted="ROLE_RIGHT_MENU_PARTICIPANTE">
							<p:menuitem icon="ui-icon-pencil" value="Enviar" title="Enviar Solicitud" action="#{dashBoardSolicitudesManagedBeanactualizarEstadoSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud,1)}" update=":formSolicitudes" disabled="#{dashBoardSolicitudesManagedBean.disableEnviarSolicitud}" />       	 
						</sec:authorize>  
                		<sec:authorize ifAnyGranted="ROLE_RIGHT_EDITA_EXPEDIENTE_CONTACTO">                  
		            		<p:menuitem icon="ui-icon-pencil" value="Editar" title="Editar Solicitud" action="#{dashBoardSolicitudesManagedBean.editaSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud)}" disabled="#{!varSolicitudI.editable}" />
    					</sec:authorize>        	 		
	        	 		<sec:authorize ifAnyGranted="ROLE_RIGHT_EDITA_EXPEDIENTE_CONTACTO">
	       		 			<p:menuitem value="Autorizar Matricula" title="Autorizar Matricula" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.actualizarEstadoSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud,2)}" update=":formSolicitudes"  />
	       		 		</sec:authorize>
	       		 		<p:menuitem value="Rechazar Solicitud" title="Rechazar Solicitud" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.actualizarEstadoSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud,3)}" update=":formSolicitudes"  />
	       		 		<p:menuitem value="Matricular Candidato" title="Matricular Candidato" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.actualizarEstadoSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud,4)}" update=":formSolicitudes:dtSolicitud"  />
	       		 		<p:menuitem value="Convocar Candidato" title="Convocar Candidato" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.actualizarEstadoSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud,5)}" update=":formSolicitudes:dtSolicitud"  />
	       		 		<p:menuitem value="Evaluar Candidato" title="Evaluar Candidato" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.actualizarEstadoSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud,8)}" update=":formSolicitudes:dtSolicitud"  />
	       		 		<p:menuitem value="Anular Solicitud" title="Anular Candidatura" style="display:inline-block;" action="#{dashBoardSolicitudesManagedBean.actualizarEstadoSolicitud(dashBoardSolicitudesManagedBean.selectedSolicitud,10)}" update=":formSolicitudes:dtSolicitud" disabled="#{!varSolicitudI.erasable}" />
	   				</p:splitButton>
				</p:column>
            </p:dataTable>
        </div>
     </h:form>
    </div>    
</h:body>
</html>