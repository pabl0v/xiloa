<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:sec="http://www.springframework.org/security/tags">

    <h:head>
       <link type="text/css" rel="stylesheet" href="../../resources/css/edicion_actividad.css"></link>
    </h:head>
    <h:body>
    <div id="contenedor"> 
      	<div id="header">
            <ui:insert name="header" >
                <ui:include src="../../modulos/compartido/paginamaestra.xhtml" />
	    	</ui:insert>
	    	<script type="text/javascript" src="../../resources/scripts/edicion_actividad.js"></script>
		</div>    
        <h2>Actividad: <h:outputText value="#{actividadManagedBean.actividad.nombre}" /></h2>
        <h:form id="form_global">
        <div id="contenedor_secciones">
            <div class="seccion_edicion" style="height:140px;">
                <div class="seccion_interna" style="height:110px; padding: 10px; margin-top:5px;">
						<p:growl id="growl" showDetail="true"/>					
             		  	<div style="dsplay:block;">
                        	<p style="width:240px; margin-bottom:20px;">Fecha inicio:</p>
                        	<span style="width:60px">
                        		<p:calendar value="#{actividadManagedBean.actividad.fechaInicial}" showOn="button" pattern="dd/MM/yyyy">
									<p:ajax event="dateSelect" update="growl" />
								</p:calendar> 
                        	</span>
                      	</div>
             		  	<div style="dsplay:block;">
                        	<p style="width:240px; margin-bottom:20px;">Fecha Fin:</p>
                        	<span style="width:60px">
                        		<p:calendar value="#{actividadManagedBean.actividad.fechaFinal}" showOn="button" pattern="dd/MM/yyyy">
									<p:ajax event="dateSelect" update="growl" />
								</p:calendar>
                        	</span>
                      	</div>                      	
                        <p>Hora:</p>
                        <p:inputText style="margin-left:5px;" value="#{actividadManagedBean.actividad.hora}" completeMethod="#{actividadManagedBean.actividad.hora}"></p:inputText>
                        <p style="margin-left:4px;">Lugar:</p>
                        <p:inputText style="margin-left:5px;" value="#{actividadManagedBean.actividad.destino}" completeMethod="#{actividadManagedBean.actividad.destino}"></p:inputText>
                </div>
            </div>          
            <div class="seccion_edicion">
                <h3>Involucrados</h3>
                <h:form styleClass="formulario_inline">
                    <p:commandButton value="Agregar involucrados" onclick="PF('dlg1').show();"/> 
                </h:form>    
                <h:form id="form_contactos_actividad">
                    <div class="seccion_interna" style="height:220px;">
                    <p:dataTable id="display_contactos_actividad" var="contacto" value="#{actividadManagedBean.actividad.involucrados}">  
                        <p:column headerText="Nombre"><h:outputText value="#{contacto.nombreCompleto}" /></p:column>  
                        <p:column headerText="Funcion"><h:outputText value="#{contacto.rol.descripcion}" /></p:column>  
                        <p:column headerText="Correo electronico"><h:outputText value="#{contacto.correo1}" /></p:column>
                    </p:dataTable>
                    </div>
                </h:form>                
            </div>
            <div class="seccion_edicion" style="position: relative;top: -100px;">
                <h3>Objetivo y alcanze de la actividad</h3>
                     <div class="seccion_interna">
                         <p:editor id="edtor_objetivo" value="#{actividadManagedBean.actividad.alcance}" height="160"/>                  
                     </div>
            </div>     
            <div id="datos_actividad" class="seccion_edicion">
                    <p>Nombre del centro evaluador : <b><h:outputText value="#{actividadManagedBean.certificacion.ifpNombre}" /></b></p>
                    <p style="display:block;margin-top:10px;">Direccion del centro evaluador: <b><h:outputText value="#{actividadManagedBean.certificacion.ifpDireccion}" /></b></p>  
	                <p>Registrado: <b><h:outputText value="#{actividadManagedBean.actividad.fechaRegistro}"><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText></b></p>
	                <br/>
	                <p>Tipo de actividad: <b><h:outputText value="#{actividadManagedBean.actividad.tipo.valor}" /></b></p>
                	<br/>                    
                	<p>Estatus:</p>
                	<p:selectOneMenu style="position:relative;top:7px;margin-left:62px;width:190px;" id="estatus" value="#{actividadManagedBean.selectedEstatusActividad}">  
	                   <f:selectItem itemLabel="Seleccione..." itemValue="" />  
	                   <f:selectItems value="#{actividadManagedBean.catalogoEstatusActividad}" var="estatus" itemLabel="#{estatus.valor}" itemValue="#{estatus.id}" />  
	                </p:selectOneMenu>
            </div>
            <div class="seccion_edicion" style="position: relative;top: -150px;">
                <h3>Materiales y/o documentos a utilizar</h3>
                     <div class="seccion_interna">
                         <p:editor id="editor_materiales" value="#{actividadManagedBean.actividad.materiales}" height="160"/>                  
                     </div>
            </div>
            <div class="seccion_edicion" style="height:30px;">
                    <p:commandButton value="Cancelar" action="#{actividadManagedBean.cancelar}"/> 
                    <p:commandButton value="Aceptar" action="#{actividadManagedBean.guardar(actividadManagedBean.actividad)}"/> 
            </div>
        </div>
        </h:form>
        
        <div id="tab_contenedor">    
                        <h:form id="form_bitacoras">
							<p:commandButton value="Agregar" style="margin-bottom: 5px" action="#{actividadManagedBean.agregarBitacora}" update=":form_bitacora" onclick="PF('dlg2').show();" rendered="#{sec:areAnyGranted('inatec')}">
							</p:commandButton>
                            <p:dataTable id="bitacorasDataTable" var="bitacora" value="#{actividadManagedBean.bitacoras}">
                                <p:column headerText="Fecha Evento"><h:outputText value="#{bitacora.fechaEvento}" ><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText></p:column>  
                                <p:column headerText="Observaciones"><h:outputText value="#{bitacora.observaciones}" ><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText></p:column>                             
								<p:column headerText="Fecha Registro"><h:outputText value="#{bitacora.fechaRegistro}" ><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText></p:column>
                                <p:column headerText="Usuario"><h:outputText value="#{bitacora.usuario.nombreCompleto}" /></p:column>
                            </p:dataTable> 
                        </h:form>    
            </div>     
    </div>
    
     <p:dialog id="modalIntegrantes" styleClass="estilo_dialogoactividades" header="Agregar involucrados:" widgetVar="dlg1" modal="true" resizable="false" width="550" height="400">
     	<h:form>
     		<h3>Agregue intregantes:</h3>
     		 <p:dataTable emptyMessage="No hay datos para mostrar"  var="contacto" value="#{actividadManagedBean.contactos}" rowKey="#{contacto.id}" selection="#{actividadManagedBean.selectedContactos}" selectionMode="multiple">  
                        <p:column headerText="Nombre"><h:outputText value="#{contacto.nombreCompleto}" /></p:column>  
                        <p:column headerText="Funcion"><h:outputText value="#{contacto.rol.descripcion}" /></p:column>  
                        <p:column headerText="Correo electronico"><h:outputText value="#{contacto.correo1}" /></p:column>  
                    </p:dataTable> 
	        <p:commandButton value="Cancelar" onclick="PF('dlg1').hide();"/> 
	        <p:commandButton value="Aceptar" update=":form_global:form_contactos_actividad:display_contactos_actividad" oncomplete="PF('dlg1').hide();"/> 
	    </h:form>   
     </p:dialog>
        
     <p:dialog id="modalBitacora" styleClass="modal_agregar_bitacora" header="Agregar bitacora" widgetVar="dlg2" modal="true" width="450" height="380" resizable="false">  
         <h:form id="form_bitacora" >
             <h3>Bitacora</h3>  
			 <p>Fecha del Evento:</p> 

			 <p:calendar value="#{actividadManagedBean.bitacora.fechaEvento}" id="fecha_evento" showOn="button" pattern="dd/MM/yyyy"/>
	        
             <h3>Descripcion del evento</h3>
             <p:inputTextarea rows="12" cols="65" value="#{actividadManagedBean.bitacora.observaciones}" queryDelay="750" minQueryLength="4" />
             <h:commandButton styleClass="botones" value="Cancelar" onclick="PF('dlg2').hide();"/>
			 <h:commandButton styleClass="botones" value="Aceptar" action="#{actividadManagedBean.guardarBitacora(actividadManagedBean.bitacora)}" update=":form_bitacoras:bitacorasDataTable, :form_bitacora" oncomplete="PF('dlg2').hide();"/>
         </h:form>
    </p:dialog>     
</h:body>
</html>