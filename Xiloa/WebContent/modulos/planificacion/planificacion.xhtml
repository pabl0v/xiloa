<?xml version='1.0' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
	  xmlns:sec="http://www.springframework.org/security/tags">
      
    <h:head>
    	<link type="text/css" rel="stylesheet" href="../../resources/css/planificacion.css"></link>
    </h:head>
    <h:body>
     <div id="contenedor">
    	<div id="header">
            <ui:insert name="header" >
                <ui:include src="../../modulos/compartido/paginamaestra.xhtml" />
	    	</ui:insert>
	        <script type="text/javascript" src="../../resources/scripts/planificacion.js"></script>
		</div>
        <h:form id="formCertificaciones">
        <div id="cabezera">
            <h2>Planificación Actual</h2>
            <sec:authorize ifAnyGranted="ROLE_RIGHT_CREAR_PLANIFICACIONES">
            	<div id="botones_filtro_contenedor">
                	<div class="botones_filtro" onclick="PF('dlg2').show();" >
                		<p class="icono_nuevo">Nueva</p>
                	</div>                           
                	<div class="botones_filtro">
                		<p class="icono_exportar"></p>
                		<h:commandLink style="margin-bottom: 5px" >  
            				<h:outputText value="Descargar" />   
            				<p:dataExporter type="xls" target=":formCertificaciones:certificaciones" fileName="ReportePlanificaciones" />           		
        				</h:commandLink>
        			</div>                
            	</div>
            </sec:authorize>
        </div>
      
        <div id="contenedor_tabla_planificacion" style="margin-top:10px;">
                <p:dataTable id="certificaciones" widgetVar="certificaciones" emptyMessage="No hay datos para mostrar" var="certificacion" value="#{planificacionManagedBean.certificaciones}" selection="#{planificacionManagedBean.selectedCertificacion}" paginator="true" rows="12" rowKey="#{certificacion.id}" selectionMode="single">  
                        <!--Las columnas de la tabla-->
                        <p:column exportable="true">
                        	<f:facet name="header">  
            					<h:outputText value="Id" />
        					</f:facet> 
                        	<h:outputText value="#{certificacion.id}"/>
                        </p:column>
                        <p:column exportable="true" filterBy="#{certificacion.nombre}"  filterMatchMode="contains">
                        	<f:facet name="header">  
            					<h:outputText value="Certificación" />
        					</f:facet> 
                        	<h:outputText value="#{certificacion.nombre}"/>
                        </p:column>
                        <p:column exportable="true" filterBy="#{certificacion.ifpNombre}" filterOptions="#{planificacionManagedBean.listaCentros}" filterMatchMode="exact">
                        	<f:facet name="header">  
            					<h:outputText value="Centro de Formación" />
        					</f:facet> 
                        	<h:outputText value="#{certificacion.ifpNombre}" />
                        </p:column>  
                        <p:column exportable="true" >
                        	<f:facet name="header">  
            					<h:outputText value="Inicia" />
        					</f:facet> 
                        	<h:outputText value="#{certificacion.inicia}"><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText>
                        </p:column>
                        <p:column exportable="true" >
                        	<f:facet name="header">  
            					<h:outputText value="Finaliza" />
        					</f:facet> 
                        	<h:outputText value="#{certificacion.finaliza}"><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText>
                        </p:column>
                        <p:column exportable="true" >
                        	<f:facet name="header">  
            					<h:outputText value="Cupo Máx." />
        					</f:facet> 
                        	<h:outputText value="#{certificacion.disponibilidad}" />
                        </p:column>                
                        <p:column exportable="true" >
                        	<f:facet name="header">  
            					<h:outputText value="Coordinador" />  
        					</f:facet> 
                        	<h:outputText value="#{certificacion.coordinador.nombreCompleto}" />
                        </p:column>                
                        <p:column exportable="true" >
                        	<f:facet name="header">  
            					<h:outputText value="Informante" />  
        					</f:facet> 
                        	<h:outputText value="#{certificacion.evaluador.nombreCompleto}" />
                        </p:column>
                        <p:column exportable="true" filterBy="#{certificacion.estatus.valor}" filterOptions="#{planificacionManagedBean.listaEstatus}" filterMatchMode="exact">
                        	<f:facet name="header">  
            					<h:outputText value="Estatus" />
        					</f:facet> 
                        	<h:outputText value="#{certificacion.estatus.valor}" />
                        </p:column>               
                        <p:column exportable="false" style="width:4%" rendered="#{sec:areAnyGranted('ROLE_RIGHT_EDITAR_PLANIFICACIONES')}">
							<p:commandButton id="editarButton" action="#{planificacionManagedBean.editarCertificacion(planificacionManagedBean.selectedCertificacion)}" icon="ui-icon-pencil" title="Editar"/>  
				        </p:column>
                </p:dataTable>
			</div>
		</h:form>
    </div>

    <p:dialog id="modalDialog" header="Seleccione la Unidad de Competencia a Planificar:" widgetVar="dlg2" modal="true" width="740" height="480">  
         <h:form id="cursosDialogo" >  
             <div id="contenedor_tabla_unidadcomp">
                <p:dataTable emptyMessage="No hay datos para mostrar" var="competencia" value="#{planificacionManagedBean.competencias}" selection="#{planificacionManagedBean.selectedCompetencia}" rowKey="#{competencia.estructuraId}" selectionMode="single"  paginator="true" rows="11" >
                    <p:column style="display:none;" headerText="idCentro"><h:outputText value="#{competencia.grupo}" /></p:column>
                    <p:column headerText="Centro de Formación Profesional"><h:outputText value="#{competencia.nombreCentro}" /></p:column>  
                    <p:column headerText="Curso"><h:outputText value="#{competencia.nombreUCompetencia}" /></p:column>  
                    <p:column headerText="Disponibilidad"><h:outputText value="#{competencia.disponibilidad}"/></p:column>  
                </p:dataTable>
             </div>
             <p:commandButton value="Cancelar" onclick="PF('dlg2').hide();"/>
             <p:commandButton value="Aceptar" update=":formCertificaciones:certificaciones" action="#{planificacionManagedBean.nuevaCertificacion(planificacionManagedBean.selectedCompetencia)}" oncomplete="PF('dlg2').hide();"/>
         </h:form>   
    </p:dialog>  
</h:body>
</html>