<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">  
    <h:head>
        <link type="text/css" rel="stylesheet" href="../../resources/css/edicion_planificacion.css"></link>
    </h:head>
    <h:body>
    <div id="contenedor">      
      	<div id="header">
            <ui:insert name="header" >
	             <ui:include src="../../modulos/compartido/paginamaestra.xhtml" />
		    </ui:insert>
		    <script type="text/javascript" src="../../resources/scripts/edicion_planificacion.js"></script>
		</div>
        <h2>Unidad de Competencia:  <h:outputText value="#{certificacionManagedBean.certificacion.nombreCompetencia}" /> </h2>
        <div id="contenedor_secciones">                   
            <div class="seccion_edicion">
                <h3>Planificacion</h3>
                <div class="seccion_interna">
                    <h:form>
                   		<p:growl id="growl" showDetail="true"/>
                   		
                        <div class="contenedor_calendario">
                            <p>Inicia la divulgacion:</p>
                            <span class="proteccion_calendario">
                            <p:calendar value="#{certificacionManagedBean.certificacion.divulgacionInicia}" id="popupButtonCal1" showOn="button" pattern="dd/MM/yyyy">
                            	<p:ajax event="dateSelect" update="growl" />  
                            </p:calendar></span>  
                        </div>   
                        
                        <div class="contenedor_calendario">
                            <p>Finaliza la inscripcion:</p>
                            <span class="proteccion_calendario">
                            <p:calendar value="#{certificacionManagedBean.certificacion.inscripcionFinaliza}" id="popupButtonCal2" showOn="button" pattern="dd/MM/yyyy">
                           		<p:ajax event="dateSelect" update="growl" /> 
                            </p:calendar></span>  
                        </div>
                        <div class="contenedor_calendario">
                            <p>Inicia convocatoria:</p>
                            <span class="proteccion_calendario">
                            <p:calendar value="#{certificacionManagedBean.certificacion.convocatoriaInicia}" id="popupButtonCal3" showOn="button" pattern="dd/MM/yyyy">
                            	<p:ajax event="dateSelect" update="growl" /> 
                            </p:calendar></span>  
                        </div>
                        <div class="contenedor_calendario">
                            <p>Inicia evaluaciones:</p>
                            <span class="proteccion_calendario">
                            <p:calendar value="#{certificacionManagedBean.certificacion.evaluacionInicia}" id="popupButtonCal4" showOn="button" pattern="dd/MM/yyyy">
                            	<p:ajax event="dateSelect" update="growl" /> 
                            </p:calendar></span>  
                        </div>                        
                    </h:form>
                </div>
            </div>          
            <div class="seccion_edicion">
                <h3>Involucrados</h3>
                <h:form styleClass="formulario_inline">
                    <p:commandButton value="Agregar involucrados" onclick="PF('dlg2').show();"/> 
                </h:form>    
                <h:form id="form">
                   <div class="seccion_interna">
                   <p:dataTable id="display" emptyMessage="No hay datos para mostrar"  var="contacto" value="#{certificacionManagedBean.certificacion.involucrados}">  
                        <p:column headerText="Nombre"><h:outputText value="#{contacto.nombreCompleto}" /></p:column>  
                        <p:column headerText="Funcion"><h:outputText value="#{contacto.rol.descripcion}" /></p:column>  
                        <p:column headerText="Correo electronico"><h:outputText value="#{contacto.correo1}" /></p:column>  
                    </p:dataTable> 
                    </div>
                </h:form>
            </div>

			<h:form id="dataForm">
            	<div class="seccion_edicion" style="height: 260px">
                <h3>Descripcion de la unidad</h3>
				<div>
					<p:editor id="editor2" value="#{certificacionManagedBean.certificacion.descripcion}" height="190"/>   
				</div>    
				<p>Estatus</p>				
				<p:selectOneMenu id="selector_estatus" styleClass="selector_status_estilo" value="#{certificacionManagedBean.selectedEstatusCertificacion}" >  
					<f:selectItem itemLabel="Seleccione..." itemValue="" />
					<f:selectItems value="#{certificacionManagedBean.catalogoEstatusCertificacion}" var="estatus" itemLabel="#{estatus.valor}" itemValue="#{estatus.id}" />
				</p:selectOneMenu>				
				</div>
				<div id="info_competencia" class="seccion_edicion" style="height: 260px;font-size:15px;">
					<p>Nombre del centro evaluador:</p>
					<div><h:outputText value="#{certificacionManagedBean.certificacion.ifpNombre}"/></div>  
					<br/>
					<p>Direccion del centro evaluador:</p>
					<div><h:outputText value="#{certificacionManagedBean.certificacion.ifpDireccion}" /></div>
					<br/>  
					<p>Costo de aranceles para el candidato:</p>
					<div>C$ <h:outputText value="#{certificacionManagedBean.certificacion.costoFormateado}" /></div> 
				</div>
				<div class="seccion_edicion" style="height: 1px"></div>
				<div class="seccion_edicion" style="height: 1px">
					<div class="contenedor_botones">
						<h:commandButton id="prueba" value="Instrumentos" action="#{instrumentoManagedBean.configurarInstrumento(certificacionManagedBean.certificacion.id,certificacionManagedBean.certificacion.nombre)}"/> 
						<h:commandButton value="Cancelar" onclick="$('#prueba').disabled=true;" action="#{certificacionManagedBean.cancelar}"/> 
						<h:commandButton value="Aceptar" action="#{certificacionManagedBean.guardarEdicion}"/>
					</div>
            	</div>
            </h:form>

			<div id="tab_contenedor">
				<p:tabView id="tabView">				
					<p:tab id="tab1" title="Todas">
						<h:form id="actividadesForm">
							<p:commandButton value="Agregar" style="margin-bottom: 5px" action="#{actividadManagedBean.reset}" update=":formDialogo1" onclick="PF('dlg1').show();">
							</p:commandButton>
							<h:panelGroup id="contenidoActividades" style="border:0">
								<p:dataTable id="actividadesDataTable" emptyMessage="No hay datos para mostrar" var="actividad" value="#{certificacionManagedBean.certificacion.actividades}" selection="#{certificacionManagedBean.selectedActividad}" paginator="true" rows="10" rowKey="#{actividad}" selectionMode="single">  
									<f:facet name="header">  
										<p:outputPanel style="text-align:right;">  
											<h:outputText value="Buscar:" />  
											<p:inputText id="globalFilter" onkeyup="carsTable.filter()" style="margin-left: 4px; width:150px" />  
										</p:outputPanel>  
									</f:facet>
									<!-- Este ajax permite mostrar el modal al hacer click en las filas de la tabla -->            
									<!-- <p:ajax event="rowSelect" listener="#{actividadManagedBean.selectedActividadListener}" oncomplete="window.location='/Xiloa/modulos/planificacion/edicion_actividad.xhtml'" >
											<f:setPropertyActionListener target="#{actividadManagedBean.actividad}" value="#{certificacionManagedBean.selectedActividad}"/>
										</p:ajax>-->
									<!-- <p:ajax event="rowSelect" listener="#{actividadManagedBean.selectedActividadListener}" />-->          
									<p:column headerText="Tipo"><h:outputText value="#{actividad.tipo.valor}" /></p:column>
									<p:column headerText="Nombre de la actividad"><h:outputText value="#{actividad.nombre}" /></p:column>    
									<p:column headerText="Lugar/Medio"><h:outputText value="#{actividad.destino}" /></p:column>  
									<p:column headerText="Fecha">
										<h:outputText value="#{actividad.fechaInicial}" >
									 		<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
										</h:outputText>
									</p:column>  
									<p:column headerText="Responsable"><h:outputText value="#{actividad.ejecutor.nombreCompleto}" /></p:column>  
									<p:column headerText="Estado"><h:outputText value="#{actividad.estado.valor}" /></p:column>
									<p:column style="width:4%">
										<p:commandButton id="selectButtonTab1" action="#{actividadManagedBean.editarActividad(certificacionManagedBean.certificacion.nombre,certificacionManagedBean.selectedActividad,certificacionManagedBean.certificacion.ifpNombre,certificacionManagedBean.certificacion.ifpDireccion)}" icon="ui-icon-pencil" title="Editar"/>  
									</p:column>
								</p:dataTable> 
							</h:panelGroup>
						</h:form>
					</p:tab>

					<p:tab id="tab2" title="Divulgacion">  
						<h:form>     
							<p:commandButton value="Agregar" style="margin-bottom: 5px" action="#{actividadManagedBean.reset}" update=":formDialogo1" onclick="PF('dlg1').show();">
							</p:commandButton>    
							<p:dataTable emptyMessage="No hay datos para mostrar" var="actividad" value="#{certificacionManagedBean.certificacion.actividades}" widgetVar="actividadesTable" filteredValue="#{tableBean.filteredCars}" paginator="true" rows="10" rowKey="#{actividad}" selectionMode="single">  
								<f:facet name="header">  
									<p:outputPanel style="text-align:right;">  
										<h:outputText value="Buscar:" />  
										<p:inputText id="globalFilter" onkeyup="carsTable.filter()" style="margin-left: 4px; width:150px" />  
									</p:outputPanel>  
								</f:facet>   
								<!-- Este ajax permite mostrar el modal al hacer click en las filas de la tabla -->            
								<p:ajax event="rowSelect" oncomplete="window.location='/Xiloa/modulos/planificacion/edicion_actividad.xhtml'" />          
								<p:column headerText="Tipo"><h:outputText value="#{actividad.tipo.valor}" /></p:column>
								<p:column headerText="Nombre de la actividad"><h:outputText value="#{actividad.nombre}" /></p:column>    
								<p:column headerText="Lugar/Medio"><h:outputText value="#{actividad.destino}" /></p:column>  
								<p:column headerText="Fecha">
									<h:outputText value="#{actividad.fechaInicial}" >
									 	<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
									</h:outputText>
								</p:column>  
								<p:column headerText="Responsable"><h:outputText value="#{actividad.ejecutor.nombreCompleto}" /></p:column>  
								<p:column headerText="Estado"><h:outputText value="#{actividad.estado.valor}" /></p:column>  
							</p:dataTable> 
						</h:form>      
					</p:tab>
					
					<p:tab id="tab3" title="Convocatoria">  
						<h:form>     
							<p:commandButton value="Agregar" style="margin-bottom: 5px" action="#{actividadManagedBean.reset}" update=":formDialogo1" onclick="PF('dlg1').show();">
							</p:commandButton>    
							<p:dataTable emptyMessage="No hay datos para mostrar" var="actividad" value="#{certificacionManagedBean.certificacion.actividades}" widgetVar="actividadesTable" filteredValue="#{tableBean.filteredCars}" paginator="true" rows="10" rowKey="#{actividad}" selectionMode="single">  
								<f:facet name="header">  
									<p:outputPanel style="text-align:right;">  
										<h:outputText value="Buscar:" />  
										<p:inputText id="globalFilter" onkeyup="carsTable.filter()" style="margin-left: 4px; width:150px" />  
									</p:outputPanel>  
								</f:facet>               
								<p:ajax event="rowSelect" oncomplete="window.location='/Xiloa/modulos/planificacion/edicion_actividad.xhtml'" />          
								<p:column headerText="Tipo"><h:outputText value="#{actividad.tipo.valor}" /></p:column>
								<p:column headerText="Nombre de la actividad"><h:outputText value="#{actividad.nombre}" /></p:column>    
								<p:column headerText="Lugar/Medio"><h:outputText value="#{actividad.destino}" /></p:column>  
								<p:column headerText="Fecha">
									<h:outputText value="#{actividad.fechaInicial}" >
									 	<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
									</h:outputText>
								</p:column>  
								<p:column headerText="Responsable"><h:outputText value="#{actividad.ejecutor.nombreCompleto}" /></p:column>  
								<p:column headerText="Estado"><h:outputText value="#{actividad.estado.valor}" /></p:column>  
							</p:dataTable> 
						</h:form>       
					</p:tab>  
                    
					<p:tab id="tab4" title="Verificacion">  
						<h:form>     
							<p:commandButton value="Agregar" style="margin-bottom: 5px" action="#{actividadManagedBean.reset}" update=":formDialogo1" onclick="PF('dlg1').show();">
							</p:commandButton>    
							<p:dataTable emptyMessage="No hay datos para mostrar" var="actividad" value="#{certificacionManagedBean.certificacion.actividades}" widgetVar="actividadesTable" filteredValue="#{tableBean.filteredCars}" paginator="true" rows="10" rowKey="#{actividad}" selectionMode="single">  
								<f:facet name="header">  
									<p:outputPanel style="text-align:right;">  
										<h:outputText value="Buscar:" />  
										<p:inputText id="globalFilter" onkeyup="carsTable.filter()" style="margin-left: 4px; width:150px" />  
									</p:outputPanel>  
								</f:facet>               
								<p:ajax event="rowSelect" oncomplete="window.location='/Xiloa/modulos/planificacion/edicion_actividad.xhtml'" />          
								<p:column headerText="Tipo"><h:outputText value="#{actividad.tipo.valor}" /></p:column>
								<p:column headerText="Nombre de la actividad"><h:outputText value="#{actividad.nombre}" /></p:column>    
								<p:column headerText="Lugar/Medio"><h:outputText value="#{actividad.destino}" /></p:column>  
								<p:column headerText="Fecha">
									<h:outputText value="#{actividad.fechaInicial}" >
									 	<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
									</h:outputText>
								</p:column>  
								<p:column headerText="Responsable"><h:outputText value="#{actividad.ejecutor.nombreCompleto}" /></p:column>  
								<p:column headerText="Estado"><h:outputText value="#{actividad.estado.valor}" /></p:column>  
							</p:dataTable> 
						</h:form>       
					</p:tab>
					<p:tab id="tab5" title="Evaluacion">  
						<h:form>     
							<p:commandButton value="Agregar" style="margin-bottom: 5px" action="#{actividadManagedBean.reset}" update=":formDialogo1" onclick="PF('dlg1').show();">
							</p:commandButton>    
							<p:dataTable emptyMessage="No hay datos para mostrar" var="actividad" value="#{certificacionManagedBean.certificacion.actividades}" widgetVar="actividadesTable" filteredValue="#{tableBean.filteredCars}" paginator="true" rows="10" rowKey="#{actividad}" selectionMode="single">  
								<f:facet name="header">  
									<p:outputPanel style="text-align:right;">  
										<h:outputText value="Buscar:" />  
										<p:inputText id="globalFilter" onkeyup="carsTable.filter()" style="margin-left: 4px; width:150px" />  
									</p:outputPanel>  
								</f:facet>               
								<p:ajax event="rowSelect" oncomplete="window.location='/Xiloa/modulos/planificacion/edicion_actividad.xhtml'" />          
								<p:column headerText="Tipo"><h:outputText value="#{actividad.tipo.valor}" /></p:column>
								<p:column headerText="Nombre de la actividad"><h:outputText value="#{actividad.nombre}" /></p:column>    
								<p:column headerText="Lugar/Medio"><h:outputText value="#{actividad.destino}" /></p:column>  
								<p:column headerText="Fecha">
									<h:outputText value="#{actividad.fechaInicial}" >
									 	<f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
									</h:outputText>
								</p:column>  
								<p:column headerText="Responsable"><h:outputText value="#{actividad.ejecutor.nombreCompleto}" /></p:column>  
								<p:column headerText="Estado"><h:outputText value="#{actividad.estado.valor}" /></p:column>  
							</p:dataTable> 
						</h:form>       
					</p:tab>					
				</p:tabView>
			</div>
		</div>
    </div>
        
	<p:dialog id="modalDialog" styleClass="estilo_dialogoactividades" header="Agregar actividades:" widgetVar="dlg1" modal="true" resizable="false" width="550" height="400">
		<div id="contenedor_dialogoactividades">
			<h:form id="formDialogo1">
				<h3>Planificacion de actividades</h3>
				<p>Nombre de la actividad</p>
				<p:inputTextarea rows="10" cols="50" value="#{actividadManagedBean.actividad.nombre}" queryDelay="750" minQueryLength="4" />
				<div class="dialogoactividades_secciones">
					<p:growl id="growl" showDetail="true"/>
					<p>Fecha:</p>
					<p:calendar value="#{actividadManagedBean.actividad.fechaInicial}" id="popupButtonCal1" showOn="button" pattern="dd/MM/yyyy">
						<p:ajax event="dateSelect" update="growl" />
					</p:calendar>
				</div>
				<div class="dialogoactividades_secciones">
					<p>Estatus:</p>
					<p:selectOneMenu id="selectEstatus" value="#{actividadManagedBean.selectedEstatusActividad}">
						<f:selectItem itemLabel="Seleccione..." itemValue="" />
						<f:selectItems value="#{actividadManagedBean.catalogoEstatusActividad}" var="estatus" itemLabel="#{estatus.valor}" itemValue="#{estatus.id}" />
					</p:selectOneMenu>
				</div> 
				<p>Lugar/Medio:</p>
				<p:inputTextarea rows="10" cols="50" value="#{actividadManagedBean.actividad.destino}" queryDelay="750" minQueryLength="4" />
				<div class="dialogoactividades_secciones2">   
					<p>Tipo de actividad:</p>
					<p:selectOneMenu id="selectTipo" value="#{actividadManagedBean.selectedTipoActividad}">
						<f:selectItem itemLabel="Seleccione..." itemValue="" />
						<f:selectItems value="#{actividadManagedBean.catalogoTiposActividad}" var="tipo" itemLabel="#{tipo.valor}" itemValue="#{tipo.id}" />
					</p:selectOneMenu>
				</div>
				
				<!--
                <h:form styleClass="formulario_inline">
                    <p:commandButton value="Agregar involucrados" onclick="PF('dlg3').show();"/> 
                </h:form>
                <h:form id="form2">
                   <div class="seccion_interna">
                   <p:dataTable id="display2" emptyMessage="No hay datos para mostrar"  var="contacto" value="#{certificacionManagedBean.selectedContactos}">  
                        <p:column headerText="Nombre"><h:outputText value="#{contacto.nombreCompleto}" /></p:column>  
                        <p:column headerText="Funcion"><h:outputText value="#{contacto.rol.descripcion}" /></p:column>  
                        <p:column headerText="Correo electronico"><h:outputText value="#{contacto.correo1}" /></p:column>  
                    </p:dataTable> 
                    </div>
                </h:form>
                -->
                <!-- 		
				<p:commandButton value="Agregar involucrados"/>
				<div id="dialogoactividades_involucrados">
					<p:dataTable var="involucrados" value="#{tableBean.carsSmall}">
						<p:column headerText="Nombre"><h:outputText value="#{car.model}" /></p:column>
						<p:column headerText="Funcion"><h:outputText value="#{car.year}" /></p:column>
						<p:column headerText="Correo electronico"><h:outputText value="#{car.manufacturer}" /></p:column>
					</p:dataTable>
				</div>
				-->
				<div id="dialogoactividades_botones">
					<h:commandButton value="Cancelar" onclick="PF('dlg1').hide();"/>
					<h:commandButton value="Aceptar" action="#{certificacionManagedBean.agregarActividad(actividadManagedBean.actividad)}" update=":tabView, :formDialogo1" oncomplete="PF('dlg1').hide();"/>
				</div>
			</h:form>
		</div>
	</p:dialog>
	
	<!-- Dialogo 2 -->
    
     <p:dialog id="modalDialog2" styleClass="estilo_dialogoactividades" header="Agregar involucrados:" widgetVar="dlg2" modal="true" resizable="false" width="550" height="400">
     	<h:form>
     		<h3>Agregue intregantes de esta lista:</h3>
     		 <p:dataTable emptyMessage="No hay datos para mostrar"  var="contacto" value="#{certificacionManagedBean.contactos}" rowKey="#{contacto.id}" selection="#{certificacionManagedBean.selectedContactos}" selectionMode="multiple">  
                        <p:column headerText="Nombre"><h:outputText value="#{contacto.nombreCompleto}" /></p:column>  
                        <p:column headerText="Funcion"><h:outputText value="#{contacto.rol.descripcion}" /></p:column>  
                        <p:column headerText="Correo electronico"><h:outputText value="#{contacto.correo1}" /></p:column>  
                    </p:dataTable> 
	        <p:commandButton value="Cancelar" onclick="PF('dlg2').hide();"/> 
	        <p:commandButton value="Aceptar" update=":form:display" oncomplete="PF('dlg2').hide();"/> 
	    </h:form>   
     </p:dialog> 
</h:body>
</html>