<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <link type="text/css" rel="stylesheet" href="../../resources/css/edicion_planificacion.css"></link>
    </h:head>
    <h:body>
    <div id="contenedor">      
      	<div id="header">
            <ui:insert name="header" >
	             <ui:include src="../../modulos/compartido/paginamaestra.xhtml" />
		    </ui:insert>
		    <script type="text/javascript" src="../../resources/scripts/edicion_planificacion.js"></script>
		</div>
        <div id="contenedor_secciones">    
			<h:form id="dataForm">
				<h:panelGrid columns="3" cellpadding="5" cellspacing="25" >
        			<h4><b>Certificación:</b></h4>
        			<p:inputText id="codigo1" size="50" value="#{certificacionManagedBean.certificacion.nombre}" required="true" requiredMessage="El nombre es requerido" >
        				<f:ajax event="blur" render="codigo1Message" />
        			</p:inputText>
        			<p:message id="codigo1Message" for="codigo1" display="text"  />
					<h4><b>Oferente:</b></h4>
					<p:inputText id="codigo2" size="50" value="#{certificacionManagedBean.certificacion.ifpNombre}" required="true" requiredMessage="El Oferente es requerido">
						<f:ajax event="blur" render="codigo2Message" />
					</p:inputText>
					<p:message id="codigo2Message" for="codigo2" display="text"  />
					<h4><b>Dirección:</b></h4>
					<p:inputText  id="codigo3" size="50" value="#{certificacionManagedBean.certificacion.ifpDireccion}" required="true" requiredMessage="La direcciÃ³n es requerida" >
						<f:ajax event="blur" render="codigo3Message" />
					</p:inputText>
					<p:message id="codigo3Message" for="codigo3" display="text"  />
					<h4><b>Coordinador:</b></h4>
					<p:inputText  id="codigo4" size="50" value="#{certificacionManagedBean.certificacion.coordinador}" required="true" requiredMessage="El coordinador es requerido" >
						<f:ajax event="blur" render="codigo4Message" />
					</p:inputText>
					<p:message id="codigo4Message" for="codigo4" display="text"  />
					<h4><b>Informante:</b></h4>
					<p:inputText  id="codigo5" size="50" value="#{certificacionManagedBean.certificacion.informante}" required="true" requiredMessage="El informante es requerido" >
							<f:ajax event="blur" render="codigo5Message" />
					</p:inputText>
					<p:message id="codigo5Message" for="codigo5" display="text"  />
					<h4><b>Inicia:</b></h4>
					<p:calendar id="codigo6" value="#{certificacionManagedBean.certificacion.inicia}" showOn="button" pattern="dd/MM/yyyy" mindate="01/06/2014" disabledWeekends="true" required="true" requiredMessage="La fecha es requerida" validatorMessage="Fecha invalida" >
						<f:ajax event="blur" render="codigo6Message" />
					</p:calendar>
					<p:message id="codigo6Message" for="codigo6" display="text"  />
					<h4><b>Finaliza:</b></h4>
					<p:calendar id="codigo7" value="#{certificacionManagedBean.certificacion.finaliza}" showOn="button" pattern="dd/MM/yyyy" mindate="01/06/2014" disabledWeekends="true" required="true" requiredMessage="La fecha es requerida" validatorMessage="Fecha invalida" >
						<f:ajax event="blur" render="codigo7Message" />
					</p:calendar>
					<p:message id="codigo7Message" for="codigo7" display="text"  />
					<h4><b>Cupo Máximo:</b></h4>
					<p:inputText id="codigo8" size="20" value="#{certificacionManagedBean.certificacion.disponibilidad}" required="true" requiredMessage="El cupo es requerido" converterMessage="El cupo debe ser numerico" >
						<f:convertNumber integerOnly="true" type="number" maxFractionDigits="0" />
						<f:ajax event="blur" render="codigo8Message" />
					</p:inputText>
					<p:message id="codigo8Message" for="codigo8" display="text"  />
					<h4><b>Arancel C$:</b></h4>
					<p:inputText id="codigo9" size="20" value="#{certificacionManagedBean.certificacion.costo}" required="true" requiredMessage="El arancel es requerido" converterMessage="El arancel debe ser numerico" >
						<f:convertNumber integerOnly="false" type="number" maxFractionDigits="2" />
						<f:ajax event="blur" render="codigo9Message" />
					</p:inputText>
					<p:message id="codigo9Message" for="codigo9" display="text"  />
					<h4><b>Estatus:</b></h4>
					<p:selectOneMenu id="selector_estatus" style="width:44%;" value="#{certificacionManagedBean.selectedEstatusCertificacion}" required="true" requiredMessage="Debe seleccionar el estatus" >  
						<f:selectItem itemLabel="Seleccione..." itemValue="0" noSelectionOption="true" />
						<f:selectItems value="#{certificacionManagedBean.catalogoEstatusCertificacion}" var="estatus" itemLabel="#{estatus.valor}" itemValue="#{estatus.id}" />
						<f:ajax event="blur" render="selectorMessage" />
					</p:selectOneMenu>
					<p:message id="selectorMessage" for="selector_estatus" display="text"  />			
				</h:panelGrid>
				<br/>
				<div>
					<p:commandButton value="Cancelar" action="#{certificacionManagedBean.cancelar}" immediate="true" /> 
					<p:commandButton value="Aceptar" action="#{certificacionManagedBean.guardarEdicion}" />
				</div>
            </h:form>
			<div>
						<h:form id="actividadesForm">
							<h:panelGroup id="contenidoActividades" style="border:0">
								<p:dataTable id="actividadesDataTable" emptyMessage="No hay datos para mostrar" var="actividad" value="#{certificacionManagedBean.actividades}" paginator="true" rows="6" rowKey="#{actividad.id}" selectionMode="single">
									<p:ajax event="rowSelect" listener="#{certificacionManagedBean.onActividadSelect}" update=":formEditarActividad" />  
									<p:ajax event="rowUnselect" listener="#{certificacionManagedBean.onActividadUnselect}" />									  
									<p:column headerText="Tipo"><h:outputText value="#{actividad.tipo.valor}" /></p:column>    
									<p:column headerText="Lugar/Medio"><h:outputText value="#{actividad.destino}" /></p:column>  
									<p:column headerText="Inicia"><h:outputText value="#{actividad.fechaInicial}" ><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText></p:column>  
									<p:column headerText="Finaliza"><h:outputText value="#{actividad.fechaFinal}" ><f:convertDateTime type="date" pattern="dd/MM/yyyy"/></h:outputText></p:column>
									<p:column headerText="Estado"><h:outputText value="#{actividad.estado.valor}" /></p:column>
									<p:column style="width:4%">
										<p:commandButton icon="ui-icon-pencil" title="Editar" update=":formEditarActividad" onclick="PF('dlg2').show();" />  
									</p:column>
								</p:dataTable> 
							</h:panelGroup>
						</h:form>
			</div>
		</div>
    </div>
	<p:dialog id="modalDialog1" styleClass="estilo_dialogoactividades" header="Agregar actividades:" widgetVar="dlg1" modal="true" resizable="false" width="550" height="400">
		<div id="contenedor_dialogoactividades">
			<h:form id="formDialogo1">
				<h3>Planificacion de actividades</h3>
				<p>Nombre de la actividad</p>
				<p:inputTextarea rows="10" cols="50" value="#{actividadManagedBean.actividad.nombre}" queryDelay="750" minQueryLength="4" />
				<p>Lugar/Medio:</p>
				<p:inputTextarea rows="10" cols="50" value="#{actividadManagedBean.actividad.destino}" queryDelay="750" minQueryLength="4" />
				<div class="dialogoactividades_secciones2">
					<p>Tipo de actividad:</p>
					<p:selectOneMenu id="selectTipo" value="#{actividadManagedBean.selectedTipoActividad}">
						<f:selectItem itemLabel="Seleccione..." itemValue="" />
						<f:selectItems value="#{actividadManagedBean.catalogoTiposActividad}" var="tipo" itemLabel="#{tipo.valor}" itemValue="#{tipo.id}" />
					</p:selectOneMenu>
				</div>
				<div id="dialogoactividades_botones">
					<h:commandButton value="Cancelar" onclick="PF('dlg1').hide();"/>
					<h:commandButton value="Aceptar" action="#{certificacionManagedBean.agregarActividad(actividadManagedBean.actividad)}" update=":tabView, :formDialogo1" oncomplete="PF('dlg1').hide();"/>
				</div>
			</h:form>
		</div>
	</p:dialog>
	<div id="contenedor_dialogoactividades" >
	<p:dialog header="Editando la Actividad:" widgetVar="dlg2" modal="true" resizable="false" width="500" height="550">
		<h:form id="formEditarActividad">
			<br/>
			<h:panelGrid columns="2" cellpadding="4">
			<h:outputLabel value="Nombre:" />
			<p:inputText id="codigo1" style="width:200%;" readonly="true" value="#{certificacionManagedBean.selectedActividad.nombre}" />
			<p:message for="codigo1" display="text"  />
			<br/>
		  	<h:outputLabel value="Fecha Inicia:" />
			<p:calendar id="codigo2" value="#{certificacionManagedBean.selectedActividad.fechaInicial}" showOn="button" pattern="dd/MM/yyyy" mindate="01/06/2014" disabledWeekends="true" required="true" requiredMessage="La fecha es requerida" validatorMessage="Fecha invalida" />
            <p:message for="codigo2" display="text"  />
            <br/>
		  	<h:outputLabel value="Fecha Final:" />
			<p:calendar id="codigo3" value="#{certificacionManagedBean.selectedActividad.fechaFinal}" showOn="button" pattern="dd/MM/yyyy" mindate="01/06/2014" disabledWeekends="true" required="true" requiredMessage="La fecha es requerida" validatorMessage="Fecha invalida" />
            <p:message for="codigo3" display="text"  />
            <br/>
			<h:outputLabel value="Materiales:" />
			<p:inputText id="codigo4" style="width:200%;" value="#{certificacionManagedBean.selectedActividad.materiales}" />
			<p:message for="codigo4" display="text"  />
			<br/>
            <h:outputLabel value="Estado:" />
			<p:selectOneMenu id="selector_estado" style="width:98%; height:25px;" required="true" requiredMessage="Debe seleccionar el estado" value="#{certificacionManagedBean.selectedEstatusActividad}" >  
				<f:selectItem itemLabel="Seleccione..." itemValue="0" />
				<f:selectItems value="#{certificacionManagedBean.catalogoEstatusActividad}" var="estado" itemLabel="#{estado.valor}" itemValue="#{estado.id}" />
			</p:selectOneMenu>
			<p:message for="selector_estado" display="text"  />
			</h:panelGrid>
			<br/>
			<h3 style="margin-top: 0">Involucrados</h3>
			<p:pickList id="pickList" value="#{certificacionManagedBean.involucrados}" var="involucrado" itemLabel="#{involucrado.nombreCompleto}" itemValue="#{involucrado}" converter="pickListConverter" >
				<p:ajax event="transfer" listener="#{certificacionManagedBean.onElementTransfer}" update="pickList" />
			</p:pickList>
			<br/>
			<br/>
			<div>
	            <p:commandButton value="Cancelar" oncomplete="PF('dlg2').hide();" immediate="true" /> 
				<p:commandButton value="Aceptar" oncomplete="if (!args.validationFailed) dlg2.hide()" update=":actividadesForm, :formEditarActividad" action="#{certificacionManagedBean.guardarActividad()}" />
			</div>
		</h:form>
	</p:dialog>
	</div>
</h:body>
</html>